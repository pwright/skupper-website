<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Skupper - Getting started</title>
    <meta name="description" content="Multicluster communication for Kubernetes.  Skupper is a layer 7 service interconnect.  It enables secure communication across Kubernetes clusters with no VPNs or special firewall rules."/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto+Mono:400,400italic|Alegreya+Sans:300,300italic,400,400italic,500,500italic,700,700italic;display=optional"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" defer/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" defer/>
    <link rel="stylesheet" href="/main.css"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/images/skupper-icon-32.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/images/skupper-icon-256.png">
    <script type="text/javascript" src="/main.js" defer="defer"></script>



    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-147980770-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'UA-147980770-1');
    </script>
  </head>
  <body>

<header id="-large-device-header">
  <nav id="-site-nav">
    <div>
      <div id="-left-site-nav">
        <a href="/index.html" id="-logotype">
          <img src="/images/skupper-logo.svg"/>
          <div>Skupper</div>
        </a>
        <a href="/start/index.html">
          <div>Getting started</div>
        </a>
        <a href="/examples/index.html">
          <div>Examples</div>
        </a>
        <a href="/docs/index.html">
          <div>Documentation</div>
        </a>
        <a href="/community/index.html">
          <div>Community</div>
        </a>
      </div>
      <div id="-right-site-nav">
        <a href="https://github.com/skupperproject">
          <div><span class="fab fa-github fa-lg"></span> GitHub</div>
        </a>
      </div>
    </div>
  </nav>
  <nav id="-path-nav">
    <div>
      <a href="/start/index.html">Getting started</a>
      <span class="path-separator">&rsaquo;</span>
      Getting started
    </div>
  </nav>
</header>
<header id="-small-device-header">
  <nav id="-site-nav">
    <a id="-site-menu-button">
      <span class="material-icons">menu</span>
    </a>
    <a href="/index.html" id="-logotype">
      <img src="/images/skupper-logo.svg"/>
      <div>Skupper</div>
    </a>
    <a href="https://github.com/skupperproject"><span class="fab fa-github fa-lg"></span></a>
  </nav>
  <nav id="-path-nav">
    <div>
      
      <span class="path-separator">&rsaquo;</span>
      Getting started
    </div>
  </nav>
  <nav id="-site-menu-layer">
    <div>
      <a href="/index.html">Home</a>
      <a href="/start/index.html">Getting started</a>
      <a href="/examples/index.html">Examples</a>
      <a href="/docs/index.html">Documentation</a>
      <a href="/community/index.html">Community</a>
    </div>
  </nav>
</header>


<section>
  <div>
    <main>

<h1 id="getting-started-with-skupper-on-openshift">Getting started with Skupper on OpenShift</h1>

<p>These instructions are specific to OpenShift and use a declaritive YAML-based deployment, 
however you can use YAML with other Kubernetes variants.
See <a href="./index.html">Getting Started on Kubernetes</a> for more generic and CLI based instructions.</p>

<h2 id="overview">Overview</h2>

<p>To show Skupper in action, we need an application to work with.  This
guide uses an HTTP Hello World application with a frontend service and
a backend service.  The frontend uses the backend to process requests.
In this scenario, the frontend is deployed in the <code>west</code>
Project, and the backend is deployed in the <code>east</code> Project.</p>

<p><img style="margin: 2em; width: 80%;" src="/images/hello-world-entities-openshift.svg"/></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You must have access to at least two OpenShift Projects.  In the
steps below, replace <code>west</code> and <code>east</code> with your chosen Projects.</p>

<p>Each Project can reside on <strong>any cluster you choose</strong>, and <strong>you are
not limited to two</strong>.  For convenience, you can have
them all on one cluster.</p>

<p>See the <a href="https://www.openshift.com/">OpenShift website</a> for more information.</p>

<p>These instructions require the OpenShift client, version 3.11 or later.</p>

<p>See the <a href="https://access.redhat.com/downloads/content/290">download page</a> for
more information.</p>

<p>You do not need <code>cluster-admin</code> privileges.</p>

<h2 id="step-1-configure-the-backend-project-to-use-skupper">Step 1: Configure the backend Project to use Skupper</h2>

<h3 id="create-the-backend-project-and-deploy-skupper">Create the backend project and deploy Skupper</h3>

<p>To deploy the site controller:</p>

<pre><code>$ oc new-project east
$ oc apply -f https://raw.githubusercontent.com/skupperproject/skupper/0.3/cmd/site-controller/deploy-watch-current-ns.yaml
</code></pre>

<h3 id="create-a-skupper-site-in-the-east-project">Create a Skupper site in the east Project</h3>

<p>To create a Skupper site, you must apply a ConfigMap.</p>

<p>Create a file named <code>east-site.yml</code></p>

<pre><code>apiVersion: v1
data:
  cluster-local: "false"
  console: "true"
  console-authentication: internal
  console-password: "barney"
  console-user: "rubble"
  edge: "false"
  name: east-site
  router-console: "true"
  service-controller: "true"
  service-sync: "true"
kind: ConfigMap
metadata:
  name: skupper-site
</code></pre>

<p>Note that the <code>data:name</code> value of <code>east-site</code>.</p>

<p>To apply the ConfigMap:</p>

<pre><code>$ oc apply -f east-site.yml
</code></pre>

<p>For more information about each parameter, see the <a href="https://github.com/skupperproject/skupper/blob/master/cmd/site-controller/README.md">Site Controller README</a>.</p>

<p>After completion, you should see deployments named <code>skupper-service-controller</code> and <code>skupper-router</code>.</p>

<h2 id="step-2-configure-the-frontend-project-to-use-skupper">Step 2: Configure the frontend Project to use Skupper</h2>

<h3 id="create-the-frontend-project-and-deploy-skupper">Create the frontend project and deploy Skupper</h3>

<p>To deploy the site controller:</p>

<pre><code>$ oc new-project west
$ oc apply -f https://raw.githubusercontent.com/skupperproject/skupper/0.3/cmd/site-controller/deploy-watch-current-ns.yaml
</code></pre>

<h3 id="create-a-skupper-site-in-the-west-project">Create a Skupper site in the west Project</h3>

<p>To create a Skupper site, you must apply a ConfigMap.</p>

<p>Create a file named <code>west-site.yml</code></p>

<pre><code>apiVersion: v1
data:
  cluster-local: "false"
  console: "true"
  console-authentication: internal
  console-password: "barney"
  console-user: "rubble"
  edge: "false"
  name: west-site
  router-console: "true"
  service-controller: "true"
  service-sync: "true"
kind: ConfigMap
metadata:
  name: skupper-site
</code></pre>

<p>Note that the <code>data:name</code> value of <code>west-site</code>.</p>

<p>To apply the ConfigMap:</p>

<pre><code>$ oc apply -f west-site.yml
</code></pre>

<p>For more information about each parameter, see the <a href="https://github.com/skupperproject/skupper/blob/master/cmd/site-controller/README.md">Site Controller README</a>.</p>

<p>After completion, you should see deployments named <code>skupper-service-controller</code> and <code>skupper-router</code>.</p>

<h2 id="step-3-connect-the-openshift-projects">Step 3: Connect the OpenShift Projects</h2>

<p>To connect the OpenShift Projects, you must create a token in one project
and pass it to the other project.</p>

<h3 id="create-a-token-request-yaml-file">Create a token request YAML file</h3>

<p>Requesting tokens requires the following format YAML file:</p>

<pre><code>apiVersion: v1
kind: Secret
metadata:
  labels:
    skupper.io/type: connection-token-request
  name: west-secret
</code></pre>

<p>Save as <code>token-request.yaml</code>.</p>

<h3 id="generate-a-connection-token">Generate a connection token</h3>

<p>Change to the <code>west</code> Project and request a token:</p>

<pre><code>$ oc project west
$ oc apply -f token-request.yaml
</code></pre>

<p>To verify this step, check that a secret named <code>west-secret</code> is created.</p>

<h3 id="pass-the-connection-token">Pass the connection token</h3>

<p>Download the token and register it with the other project.</p>

<pre><code>$ oc get secret  --export -o yaml west-secret &gt; west-secret.yaml
</code></pre>

<p>Change to the <code>east</code> Project and apply the token:</p>

<pre><code>$ oc project east
$ oc apply -f west-secret.yaml
</code></pre>

<p>You now have a Skupper network capable of multi-cluster communication,
but no services are exposed to that network.</p>

<h2 id="step-4-deploy-the-services-and-expose-the-backend-service-to-the-skupper-network">Step 4: Deploy the services and expose the backend service to the Skupper network</h2>

<h3 id="deploy-the-frontend-and-backend-services">Deploy the frontend and backend services</h3>

<p>Use <code>oc create deployment</code> to start the frontend in West.</p>

<div class="code-label session-2">West</div>

<pre><code>oc create deployment hello-world-frontend --image quay.io/skupper/hello-world-frontend
</code></pre>

<p>Likewise, use <code>oc create deployment</code> to start the backend in
East.</p>

<div class="code-label session-1">East</div>

<pre><code>oc create deployment hello-world-backend --image quay.io/skupper/hello-world-backend
</code></pre>

<h3 id="expose-the-backend-service">Expose the backend service</h3>

<p>At this point, we have the frontend and backend services running, but
the frontend has no way to contact the backend.  The frontend and
backend are in different Projects (and perhaps different clusters),
and the backend has no public ingress.</p>

<p>To expose the backend service, create annotations of the backend deployment of the <code>east</code> Project:</p>

<pre><code>oc annotate deployment/hello-world-backend skupper.io/proxy="http"
oc annotate deployment/hello-world-backend skupper.io/port="8080"
</code></pre>

<p>If you check the services in the OpenShift console of the <code>west</code> project, you should now see <code>hello-world-backend</code>.</p>

<h2 id="step-5-test-your-skupper-network">Step 5: Test your Skupper network</h2>

<p>Create a route in the <code>west</code> Project from the <code>hello-world-frontend</code> service using either of the following methods:</p>

<ul>
<li><a href="https://docs.openshift.com/container-platform/3.7/dev_guide/routes.html#creating-routes">Using the console</a></li>
<li>Using the <code>oc</code> command:
oc expose svc/hello-world-frontend --hostname=www.example.com</li>
</ul>

<p>Test the resulting url, you should see output like this:</p>

<pre><code>I am the frontend.  The backend says 'Hello from hello-world-backend-869cd94f69-wh6zt (1)'.
</code></pre>

<h3 id="summary">Summary</h3>

<p>Our simple HTTP application has two services.  We deployed each
service to a different OpenShift cluster.</p>

<p>Ordinarily, a multi-cluster deployment of this sort means that the
services have no way to communicate unless they are exposed to the
public internet.</p>

<p>By introducing Skupper into each Project, we were able to create a
virtual application network that connects the services across cluster
boundaries.</p>

<p>See the <a href="https://github.com/skupperproject/skupper-example-hello-world/blob/master/README.md#what-just-happened">Hello World
example</a>
for more detail.</p>

<h2 id="the-condensed-version">The condensed version</h2>

<div class="code-label session-1">East: Setup</div>

<pre><code>oc new-project east
oc apply -f https://raw.githubusercontent.com/skupperproject/skupper/0.3/cmd/site-controller/deploy-watch-current-ns.yaml
oc apply -f east-site.yaml
oc apply -f west-secret.yaml
oc create deployment --port 8080 hello-world-backend --image quay.io/skupper/hello-world-backend
oc annotate deployment/hello-world-backend skupper.io/proxy="http"
oc annotate deployment/hello-world-backend skupper.io/port="8080"
</code></pre>

<div class="code-label session-2">West: Setup</div>

<pre><code>oc new-project west
oc apply -f https://raw.githubusercontent.com/skupperproject/skupper/0.3/cmd/site-controller/deploy-watch-current-ns.yaml
oc apply -f west-site.yaml
oc apply -f /home/pwright/token-request.yaml
oc get secret  --export -o yaml west-secret &gt; west-secret.yaml
oc create deployment --port 8080 hello-world-backend --image quay.io/skupper/hello-world-frontend
</code></pre>

<h2 id="next-steps">Next steps</h2>

<p>Now that you know how to connect services running on multiple
clusters, here are a few more things to look at:</p>

<ul>
<li><a href="https://github.com/skupperproject/skupper-example-hello-world">Check out the HTTP Hello World example in more detail</a></li>
<li><a href="https://github.com/skupperproject/skupper-example-tcp-echo">See how you can connect any TCP-based service</a></li>
<li><a href="/examples/index.html">Explore the examples</a></li>
</ul>


    </main>
    <nav id="-toc">
      <h4>Contents</h4>
      <div></div>
    </nav>
  </div>
</section>

<footer>
  <div>
    <div>
      <p><a href="https://twitter.com/SkupperIO"><span class="fab fa-twitter fa-lg"></span> Twitter</a></p>
      <p><a href="https://www.youtube.com/channel/UCQxHN2Qq8koCatcmKCJ4OEA"><span class="fab fa-youtube fa-lg"></span> YouTube</a></p>
      <!-- <p><a href="https://stackoverflow.com/questions/tagged/skupper"><span class="fab fa-stack-overflow fa-lg"></span> Stack Overflow</a></p> -->
      <p><a href="https://groups.google.com/forum/#!forum/skupper"><span class="fas fa-envelope fa-lg"></span> Mailing list</a></p>
      <p><a href="https://github.com/skupperproject"><span class="fab fa-github fa-lg"></span> GitHub</a></p>
    </div>
    <div>
      <h4>Skupper - Multicloud communication for Kubernetes</h4>
      <p>Skupper enables secure communication across Kubernetes
        clusters with no VPNs or special firewall rules</p>
      <p>Copyright &#169; 2020 the Skupper authors</p>
    </div>
    <div>
      <p>All code and documentation is licensed under
        the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache
        License version 2.0</a></p>
      <p>Marks may be trademarks or registered trademarks of their
        respective owners</p>
    </div>
  </div>
</footer>





  </body>
</html>
